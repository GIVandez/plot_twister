<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Раскадровка и информация</title>
  <link rel="stylesheet" href="/static/storyboard/common.css" />
  <link rel="stylesheet" href="/static/storyboard/top-menu.css" />
  <link rel="stylesheet" href="/static/storyboard/frames.css" />
  <link rel="stylesheet" href="/static/storyboard/info.css" />
  <link rel="stylesheet" href="/static/storyboard/page-selector.css" />
</head>
<body>
  <header class="top-menu">
    <div class="menu-buttons">
      <!-- Оставлена только кнопка создания кадра -->
      <button class="menu-btn add-frame-btn" title="Создать кадр">+</button>

      <button class="menu-btn undo-btn" title="Отменить (Ctrl+Z)" aria-label="Отменить">⟲</button>
      <button class="menu-btn redo-btn" title="Вернуть (Ctrl+Shift+Z)" aria-label="Вернуть">⟳</button>

      <!-- Статистика: обёрнута в контейнер для абсолютного позиционирования -->
      <div class="menu-stats" id="menuStats" aria-hidden="false">
        <!-- Статистика: количество кадров -->
        <div class="menu-stat frames-stat" title="Общее количество кадров">
          Кадров: <span id="framesCount" class="stat-value">0</span>
        </div>

        <!-- Статистика: общая длительность раскадровки -->
        <div class="menu-stat duration-stat" title="Общая длительность раскадровки">
          Длительность: <span id="storyDuration" class="stat-value">00:00</span>
        </div>

        <!-- Tabs для переключения вида: Раскадровка / Сценарий -->
        <div class="view-tabs" role="tablist" aria-label="Выбор вида">
          <button class="view-tab view-tab-board" role="tab" aria-selected="true">Раскадровка</button>
          <button class="view-tab view-tab-script" role="tab" aria-selected="false">Сценарий</button>
        </div>

        <button class="menu-btn exit-workspace-btn" title="Выйти из рабочего пространства">×</button>
      </div>
    </div>
  </header>

  <main class="main-container">
    <!-- Ползунок слева от storyboard-section — ПЕРЕД секцией -->
    <div id="leftScrollbar" class="section-scrollbar" aria-hidden="true">
    </div>

    <!-- Левая часть — таблица кадров -->
    <section class="storyboard-section">
      <div class="storyboard-list" id="framesContainer" tabindex="0"></div>
    </section>

  <!-- Правая часть — информационная панель -->
  <section class="info-section">
      <!-- Отображение страницы сценария -->
      <div class="page-display" id="pageDisplay">
          <div class="page-controls" id="pageControls">
              <button class="page-action-btn" id="pageLinkBtn">Связать</button>
              <button class="page-action-btn" id="pageUnlinkBtn">Отвязать</button>
          </div>
          <div class="page-content" id="pageContent">
              <!-- Текст страницы будет загружен здесь -->
          </div>
      </div>
  </section>
  </main>

  <!-- Модальное окно выбора страницы для связки -->
  <div class="page-selector-modal" id="pageSelectorModal">
    <div class="page-selector-overlay"></div>
    <div class="page-selector-content">
      <div class="page-selector-carousel">
        <button class="page-selector-arrow page-selector-arrow-left" id="pageSelectorLeft">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="15,18 9,12 15,6"></polyline>
          </svg>
        </button>
        <div class="page-selector-track-wrapper">
          <div class="page-selector-track" id="pageSelectorTrack">
            <!-- Страницы будут добавлены динамически -->
          </div>
        </div>
        <button class="page-selector-arrow page-selector-arrow-right" id="pageSelectorRight">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="9,6 15,12 9,18"></polyline>
          </svg>
        </button>
      </div>
      <div class="page-selector-scrollbar">
        <div class="page-selector-scrollbar-track">
          <div class="page-selector-scrollbar-fill"></div>
          <div class="page-selector-scrollbar-thumb" id="pageSelectorThumb"></div>
        </div>
      </div>
      <button class="page-selector-confirm-btn" id="pageSelectorConfirm">Связать</button>
    </div>
  </div>

  <!-- ЛЕВАЯ ЧАСТЬ -->
  <script src="/static/storyboard/storyboard-data.js?v=1"></script>
  <script src="/static/storyboard/storyboard-store.js?v=1"></script>
  <script src="/static/storyboard/frames-render.js?v=1"></script>
  <script src="/static/storyboard/frames-dragdrop.js?v=1"></script>
  <script src="/static/storyboard/frames-add.js?v=1"></script>
  
  <!-- ДАННЫЕ И УПРАВЛЕНИЕ СТРАНИЦАМИ -->
  <script src="/static/storyboard/page-info.js?v=1"></script>
  <script src="/static/storyboard/frames-click.js?v=1"></script>


  <script src="/static/storyboard/frames-blocks.js?v=1"></script>
  <script src="/static/storyboard/page-selector.js?v=1"></script>

  <!-- ОСНОВНОЙ СКРИПТ -->
  <script>
    // Переход на локальную страницу сценария по кнопке "Сценарий" (с передачей project id)
    document.addEventListener('DOMContentLoaded', function () {
      const scriptTab = document.querySelector('.view-tab.view-tab-script');
      function _getProjectId() {
        const params = new URLSearchParams(window.location.search);
        return params.get('project') || window.currentProjectId || '1';
      }

      // Exit workspace button
      const exitBtn = document.querySelector('.menu-btn.exit-workspace-btn');
      if (exitBtn) {
        exitBtn.addEventListener('click', function(e){
          e.preventDefault();
          const pid = _getProjectId();
          // Absolute URL to ProjectMainPage with projectId parameter
          window.location.href = 'http://127.0.0.1:8000/project/ProjectMainPage.html?projectId=' + encodeURIComponent(pid);
        });
      }

      if (scriptTab) {
        scriptTab.addEventListener('click', function (e) {
          e.preventDefault();
          const pid = _getProjectId();
          window.location.href = '/static/script/script.html?project=' + encodeURIComponent(pid);
        });
      }
    });
  </script>
   <script src="/static/storyboard/main.js?v=1"></script>
</body>
</html>