Модель авторизации
Класс AuthModel
V login(username: str, password: str) -> auth_token: int
Проверяет логин и пароль пользователя в таблице user

Аргументы:

username - логин пользователя
password - пароль пользователя
Алгоритм:

Вызвать метод DatabaseRepository.login_user();
Сгенерировать auth_token и вернуть его пользователю
Выполнить поиск пользователя в таблице user по логину вызовом метода self.user_exist(username)
В случае ненахождения пользователя по логину в БД вернуть status=1
В случае нахождения пользователя по логину получить пароль пользователя вызовом функции DatabaseRepository.read_user_info()
Сравнить полученный из БД пароль пользователя из таблицы с переданным функции в аргументе password паролем
В случае совпадения паролей вернуть auth_token, в случае несовпадения вернуть status=2


V register(username: str, password: str, email: str) -> auth_token: int
Проверяет отсутствие логина и пароля пользователя в таблице user, в случае успеха создает новую запись о пользователе в таблице user

Аргументы:

username - логин пользователя
password - пароль пользователя
email - email пользователя
Алгоритм:

Проверить наличие учетной записи с переданными данными вызовом метода DatabaseRepository.user_exist();
Если учетная запись существует, то вернуть auth_token=None
Если учетная запись отсутствует, то создать новую учетную запись вызовом метода DatabaseRepository.create_user();
Сгенерировать auth_token
Вернуть auth_token пользователю
Модель пользователя
Класс UserModel
V get_user_info(username: int) -> user_info {username: str, password: str, email: str}
Получение информации о пользователе (email, псевдоним)

Аргументы:

username: логин пользователя
Алгоритм:

Получить информацию о пользователе вызовом метода DatabaseRepository.read_user_info()
Вернуть результаты запросы в виде словаря user


V get_user_projects(username: int) -> user_projects: list[str]
Получение списка проектов пользователя

Аргументы:

username - логин пользователя
Алгоритм:

Получить список проектов пользователя вызовом метода DatabaseRepository.read_user_projects()
Вернуть результаты запроса в виде списка user_projects


V edit_user_info(user_info {username: str, password: str, email: str}) -> success: bool
Редактирование информации о пользователе

Аргументы:

user_info - словарь с новой информацией о пользователе
Алгоритм:

Разобрать словарь user_info на параметры пользователя
Обновить информацию о пользователе в БД вызовом функции DatabaseRepository.update_user_info() с полученными параметрами


V delete_user(username: str) -> success: bool
Каскадно удаляет запись о пользователе и всех его проектах

Аргументы:

username - логин пользователя
Алгоритм:

Проверить наличие учетной записи с переданными данными вызовом метода DatabaseRepository.user_exist();
Если учетная запись существует, то удалить её вызовом метода DatabaseRepository.delete_user();
Модель администратора
Класс AdminModel
V new_user(user_info {username: str, password: str, email: str}) -> success: bool
Проверяет отсутствие логина и пароля пользователя в таблице user, в случае успеха создает новую запись о пользователе в таблице user

Аргументы:

user_info - информация о пользователе в виде словаря
Алгоритм:

Разобрать словарь user_info на параметры пользователя
Проверить наличие учетной записи с переданными данными вызовом метода DatabaseRepository.user_exist();
Если учетная запись существует, то вернуть success=False
Если учетная запись отсутствует, то создать новую учетную запись вызовом метода DatabaseRepository.create_user();
Вернуть success=True


V give_admin_role(user_id) -> success: bool
Выдает пользователю роль администратора

Аргументы:

user_id - id пользователя
Алгоритм:

Найти в таблице user пользователя с id=user_id и изменить значение поля role на "admin" вызовом функции DatabaseRepository.update_user_info()
В случае успеха вернуть success=True, иначе success=False


V remove_admin_role(user_id) -> success: bool
Отнимает у пользователя роль администратора

Аргументы:

user_id - id пользователя
Алгоритм:

Найти в таблице user пользователя с id=user_id и изменить значение поля role на "user" вызовом функции DatabaseRepository.update_user_info()
В случае успеха вернуть success=True, иначе success=False
V edit_user_info(user_info {username: str, password: str, email: str}) -> success: bool
Редактирует данные о пользователе

Аргументы:

user_info - информация о пользователе в виде словаря
Алгоритм:

Разобрать словарь user_info на параметры пользователя
Проверить наличие учетной записи с переданными данными вызовом метода DatabaseRepository.user_exist();
В случае отсутствия учетной записи с переданными данными вернуть success=False
Обновить информацию о пользователе в БД вызовом функции DatabaseRepository.update_user_info() с полученными параметрами
Вернуть success=True


V delete_user(username: str) -> success: bool
Удаляет запись о пользователе из таблицы user и всех его проектах из таблиц project, page, frame

Аргументы:

username - логин пользователя
Алгоритм:

Проверить наличие учетной записи с переданными данными вызовом метода DatabaseRepository.user_exist();
Если учетная запись не существует, вернуть success=False
Если учетная запись существует, то удалить её вызовом метода DatabaseRepository.delete_user();
Вернуть success=True


Модель графического редактора
Класс GraphicEditorModel
V get_pic(frame_id: int) -> frame_info: File
Получение изображения кадра

Аргументы:

frame_id - id кадра
Алгоритм:

Получить путь к изображению кадра из таблицы frame вызовом метода DatabaseRepository.get_frame_info(frame_id);
Найти изображение кадра на сервере
Вернуть полученный файл в виде словаря


V upload_pic(frame_id: int, frame_path: str, frame_pic: File) -> success: bool
Редактирование информации о страницы

Аргументы:

frame_id - id редактируемого кадра
frame_path - путь к новому файлу
frame_pic: File - изображение кадра
Алгоритм:

По frame_id найти кадр, которому принадлежит изображение
Сохранить изображение frame_pic на сервере
Обновить информацию о кадре страницы в таблице page БД вызовом метода DatabaseRepository.update_frame_info(frame_path);
В случае успеха вернуть success=True, в случае провала success=False








Модель проектов
Класс ProjectModel
V new_project(username: int, project_name: text) -> success: bool
Редактирование сценария проекта

Аргументы:

username - логин владельца проекта
project_name - название проекта
Алгоритм:

Проверить отсутствие проекта с таким же названием, как переданный аргумент project_name, и с таким же владельцем, как переданный аргумент username, в таблице project вызовом метода DatabaseRepository.user_project_exist()
В случае нарушения одного или обоих условий вернуть success=False
В случае соблюдения обоих условий создать новый проект с названием project_name и владельцем username
Вернуть success=True
V edit_project_name(project_id: int, new_project_name: text) -> success: bool
Редактирование сценария проекта

Аргументы:

project_id - id проекта
project_name - название проекта
Алгоритм:

Найти в таблице project БД проект с id=project_id вы помощи вызова метода DatabaseRepository.update_project_name()
В случае успеха вернуть success=True, иначе success=False


V delete_project(project_id: int) -> success: bool
Удаление проекта

Аргументы:

project_id - id проекта
Алгоритм:

Найти в таблице project БД проект с id=project_id и найти в таблице frames пути к изображениям кадров, которые принадлежат данному проекту
Удалить найденные изображения кадров
При помощи вызова метода DatabaseRepository.delete_project() удалить информацию о проекте
В случае успеха вернуть success=True, иначе success=False


V delete_script(project_id: int) -> success: bool
Удаление сценария проекта

Аргументы:

project_id - id проекта
Алгоритм:

Найти в таблице page все записи о страницах сценария, где project_id=project_id
Удалить найденные записи страниц вызовом функции DatabaseRepository.delete_page() в цикле
В случае успеха вернуть success=True, иначе success=False


V delete_frames(project_id: int) -> success: bool
Удаление раскадровки проекта

Аргументы:

project_id - id проекта
Алгоритм:

Найти в таблице frame все записи о кадрах сценария, где project_id=project_id и найти в таблице frame пути к изображениям кадров, которые принадлежат данному проекту
Удалить найденные изображения кадров
Удалить найденные записи страниц вызовом функции DatabaseRepository.delete_frame() в цикле
В случае успеха вернуть success=True, иначе success=False


V connect_fp(frame_id: int, page_id: int) -> success: bool
Связывание кадра со страницей сценария

Аргументы:

frame_id - id кадра
page_id - id страницы
Алгоритм:

Связать кадр со страницей при помощи вызова метода Database.update_frame_info(frame_id, page=page_id)
В случае успеха вернуть success=True, иначе success=False


V disconnect_fp(frame_id: int) -> success: bool
Разрыв связи кадра со страницей сценария

Аргументы:

frame_id - id кадра
Алгоритм:

Связать кадр со страницей при помощи вызова метода Database.update_frame_info(frame_id, page=None)
В случае успеха вернуть success=True, иначе success=False
Модель кадров
Класс FrameModel
V new_frame(username: int, new_frame_data: dict) -> success: bool
Создание нового кадра проекта

Аргументы:

username - логин владельца проекта
new_frame_data - словарь с информацией о новом кадре
Алгоритм:

Вызвать функцию DatabaseRepository.create_frame() с аргументами, полученными из словаря new_frame_dict
В случае успеха вернуть success=True, в случае провала success=False


V get_frame_info(frame_id: int) -> frame_info: dict
Получение подробной информации о кадре

Аргументы:

frame_id - id кадра
Алгоритм:

Получить информацию о кадре из таблицы frame вызовом метода DatabaseRepository.get_frame_info();
Вернуть полученные данные в виде словаря


V edit_frame_info(frame_id: int, new_frame_data: dict) -> success: bool
Редактирование информации о страницы

Аргументы:

frame_id - id редактируемого кадра
new_frame_data: dict - информация о кадре
Алгоритм:

Распарсить словарь new_frame_data на параметры кадра
Обновить информацию о кадре страницы в таблице page БД вызовом метода DatabaseRepository.update_frame_info();
В случае успеха вернуть success=True, в случае провала success=False


V delete_frame(frame_id: int) -> success: bool
Удаление кадра

Аргументы:

frame_id - id проекта
Алгоритм:

Найти в таблице frame БД кадр с id=frame_id и удалить его
Удалить изображение кадра по пути из записи о кадре в таблице frame
В случае успеха вернуть success=True, иначе success=False


V get_frame_pic(frame_id: int) -> frame_info: File
Получение изображения кадра

Аргументы:

frame_id - id кадра
Алгоритм:

Получить путь к изображению кадра из таблицы frame вызовом метода DatabaseRepository.get_frame_info(frame_id);
Найти изображение кадра на сервере
Вернуть полученный файл в виде словаря


V upload_frame_pic(frame_id: int, frame_path: str, frame_pic: File) -> success: bool
Редактирование информации о страницы

Аргументы:

frame_id - id редактируемого кадра
frame_path - путь к новому файлу
frame_pic: dict - информация о кадре
Алгоритм:

По frame_id найти кадр, которому принадлежит изображение
Сохранить изображение frame_pic на сервере
Обновить информацию о кадре страницы в таблице page БД вызовом метода DatabaseRepository.update_frame_info(frame_path);
В случае успеха вернуть success=True, в случае провала success=False


V delete_frame_pic(frame_id: int) -> success: bool
Удаление кадра

Аргументы:

frame_id - id проекта
Алгоритм:

Найти в таблице frame БД кадр с id=frame_id и удалить изображение кадра по пути, находящемуся в записи о кадре
В случае успеха вернуть success=True, иначе success=False
Модель сценариев
Класс PageModel
V new_page(project_id: int, number: int, text=Null: str) -> success: bool
Создание новой страницы сценария

Аргументы:

project_id - id проекта
number: int - порядковый номер страницы в сценарии
text: str - текстовое содержимое страницы
Алгоритм:

Создать запись о новой странице в БД вызовом метода DatabaseRepository.create_page(project_id, number, text);
В случае успеха вернуть success=True, в случае провала success=False


V get_page(page_id: int) -> page_info: dict
Получение информации о странице

Аргументы:

page_id - id редактируемой страницы
Алгоритм:

Получить информацию о странице в таблице page БД вызовом метода DatabaseRepository.read_page_info(page_id);
Вернуть полученную информацию в виде словаря


V edit_page(page_id: int, new_page_data: dict) -> success: bool
Редактирование информации о страницы

Аргументы:

page_id - id редактируемой страницы
new_page_data: dict - информация о странице
Алгоритм:

Обновить информацию о тексте страницы в таблице page БД вызовом метода DatabaseRepository.update_page_text(page_id, new_page_data[page_text]);
Обновить номер страницы в БД вызовом метода DatabaseRepository.update_page_number(page_id, new_page_data[page_number]);
В случае успеха вернуть success=True, в случае провала success=False


V delete_page(page_id: int) -> success: bool
Удаление страницы сценария

Аргументы:

page_id - id страницы
Алгоритм:

Каскадно удалить из таблицы page БД запись о странице вызовом метода DatabaseRepository.delete_page(page_id);
В случае успеха вернуть success=True, в случае провала success=False
Модель БД
Класс DatabaseRepository
V create_user(username: text, password: text, email: text) -> success: bool
Создание записи для нового пользователя

Аргументы:

username - логин пользователя
password - пароль пользователя
email - email пользователя
Алгоритм:

Выполнить поиск пользователя в таблице user по логину вызовом метода self.user_exist(login)
В случае нахождения пользователя по логину в БД вернуть success=False
В случае ненахождения пользователя по логину создать в таблице user БД запись о новом пользователе с данными login, password, email
Вернуть success=True


V read_user_info(username: str) -> user {username: str, password: str, email: str}
Получение информации о пользователе (логин, пароль, email)

Аргументы:

username - логин пользователя
password - пароль пользователя
email - email пользователя
Алгоритм:

Выполнить поиск информации о пользователе в таблице user БД по его логину (username)
Вернуть результат поиска в виде словаря user


V update_user_info(username: str, password=None: str, email=None: str, role=None: str) -> success: bool
Изменение информации о пользователе

Аргументы:

username - логин пользователя
password - пароль пользователя
email - email пользователя
role - роль пользователя
Алгоритм:

Выполнить поиск записи о пользователе с логином username в таблице user БД и обновить информацию о нем в зависимости от переданных аргументов (password, email, role)
В случае успеха вернуть success=True, в случае провала success=False
V delete_user(username) -> success: bool
Удаление пользователя и его проектов

Аргументы:

username - логин пользователя
Алгоритм:

Выполнить поиск записи о пользователе с логином username в таблице user БД
Удалить найденную запись с каскадным удалением записей в дочерних таблицах
В случае успеха вернуть success=True, иначе success=False


V user_exist(username: text) -> exist: bool
Проверка наличия пользователя с переданным логином

Аргументы:

username - логин проверяемого пользователя
Алгоритм:

Выполнить поиск пользователя по username в таблице user
В случае нахождения записи о пользователе вернуть exist=True, в противном случае вернуть exist=False


V user_project_exist(project_name:text, username: text) -> exist:bool
Проверка наличия проекта с переданным названием

Аргументы:

project_name - название проверяемого проекта
username - логин проверяемого пользователя
Алгоритм:

Выполнить поиск проекта по project_name с владельцем username в таблице project
В случае нахождения записи о проекте вернуть exist=True, в противном случае вернуть exist=False
read_user_projects(username: str) -> projects: list[int]
Получение списка названий проектов пользователя

Аргументы:

username - логин пользователя
Алгоритм:

Выполнить поиск всех записей о проектах, создателем которых является пользователь с логином username, в таблице project
Вернуть список с результатами поиска в виде списка list


V create_project(name: text, owner_id: int) -> success: bool
Создание нового проекта пользователя

Аргументы:

name- название проекта
owner_id - id владельца проекта
Алгоритм:

Создать в таблице project БД запись о новом проекте с данными name, owner_id
В случае успеха вернуть success=True, иначе success=False


V read_project_info(project_id: int) -> project_info: {project_name: str, owner_username: str}
Получение информации о проекте пользователя

Аргументы:

project_id - id проекта
Алгоритм:

Найти в таблице project БД по project_id информацию о проекте и вернуть ее в виде словаря


V update_project_name(project_id: int, new_name: text) -> success: bool
Изменение названия проекта

Аргументы:

project_id - id проекта
new_name- новое название проекта
Алгоритм:

Найти в таблице project БД по project_id запись о проекте и изменить название проекта на new_name
В случае успеха вернуть success=True, иначе success=False


V delete_project(project_id: int) -> success: bool
Удаление проекта пользователя

Аргументы:

project_id - id проекта
Алгоритм:

Найти в таблице project БД по project_id запись о проекте и удалить ее каскадно
Удалить все изображения кадров, принадлежащих проекту
В случае успеха вернуть success=True, иначе success=False


create_frame(project_id: int, start_time: int, end_time: int, pic_path: str, description=None: str) -> success: bool
Создание записи о новом кадре

Аргументы: project_id - id родительского проекта проекта start_time - время начала кадра в секундах end_time - время конца кадра в секундах pic_path - относительный путь к изображению кадра на сервере description - описание кадра, по умолчанию присваивается значение None

Алгоритм:

Создать в таблице frame БД запись о новом кадре с информацией (project_id, start_time, end_time, pic_path, desctiption)
В случае успеха вернуть success=True, в случае провала success=False


read_frame_info(frame_id) -> frame {description: str, start_time: int, end_time: int, pic_path: str}
Получение информации о кадре

Аргументы:

frame_id - id кадра
Алгоритм:

Выполнить поиск информации о кадре в таблице frame БД по его id (frame_id)
Вернуть найденную информацию в виде словаря frame


V update_frame_info(frame_id: int, start_time=None: int, end_time=None: int, pic_path=None: str, description=None: str) -> success: bool
Изменение информации о кадре

Аргументы:

frame_id - id кадра
start_time - время начала кадра в секундах
end_time - время конца кадра в секундах
pic_path - относительный путь к изображению кадра на сервере
description - описание кадра
Алгоритм:

Обновить start_time кадра в таблице frame БД, если аргумент start_time передан в функцию
Обновить end_time кадра в таблице frame БД, если аргумент end_time передан в функцию
Обновить pic_path кадра в таблице frame БД, если аргумент pic_path передан в функцию
Обновить description кадра в таблице frame БД, если аргумент description передан в функцию
В случае успеха вернуть success=True, в случае провала success=False
delete_frame(frame_id: int) -> success: bool
Удаление записи о кадре

Аргументы:

frame_id - id кадра
Алгоритм:

Выполнить поиск записи о кадре по id (frame_id) в таблице frame БД
Удалить изображение кадра по пути, хранящемуся в найденной записи
Удалить найденную запись
В случае успеха вернуть success=True, иначе success=False


change_pic(frame_id: int, new_pic_path: str) -> success: bool
Изменение изображения кадра

Аргументы:

frame_id - id кадра
new_pic_path - путь к новому изображению кадра
Алгоритм:

Выполнить поиск записи о кадре по id (frame_id) в таблице frame БД
Удалить изображение кадра по пути, хранящемуся в найденной записи
Сохранить новый файл с именем new_pic_path.split("/")[-1] в хранилище по пути new_pic_path
В случае успеха вернуть success=True, в случае провала success=False


read_pic_path(frame_id) -> pic_path: str
Получение пути к изображению кадра

Аргументы:

frame_id - id кадра
Алгоритм:

Выполнить поиск записи о кадре по id (frame_id) в таблице frame БД
Вернуть pic_path найденной записи в виде переменной pic_path


create_page(project_id: int, number: int, text=None: str) -> success: bool
Создание записи о новой странице сценария

Аргументы: project_id - id родительского проекта number - порядковый номер страницы в сценарии проекта text - текстовое содержание страницы, по умолчанию принимает значение None

Алгоритм:

Создать запись с информацией о новой странице (project_id, number, text) в таблице page БД
В случае успеха вернуть success=True, в случае провала success=False


read_page_info(page_id: int) -> page {number: int, text: str}
Получение информации о странице сценария

Аргументы:

page_id - id страницы
Алгоритм:

Выполнить поиск записи о странице по id (page_id) в таблице page БД
Вернуть информацию о найденной записи в виде словаря page


V update_page_text(page_id: int, text: str) -> success: bool
Изменение информации о странице сценария

Аргументы:

page_id - id страницы
text - текстовое содержание страницы, по умолчанию принимает значение None
Алгоритм:

Обновить текст страницы (text) в таблице page БД
В случае успеха вернуть success=True, в случае провала success=False
delete_page(page_id: int) -> success: bool
Удаление записи о странице сценария

Аргументы:

page_id - id страницы
Алгоритм:

Выполнить поиск записи о странице по id (page_id) в таблице page БД
Удалить найденную запись
В случае успеха вернуть success=True, в случае провала success=False


V update_page_number(page_id: int, new_page_number: int) -> success: bool
Изменение номера страницы сценария

Аргументы:

page_id - id страницы
new_page_number - новый порядковый номер страницы в сценарии проекта
Алгоритм:

Выполнить поиск записи о странице по id (page_id) в таблице page БД
Заменить поле number найденной записи на значение new_page_number
В случае успеха вернуть success=True, в случае провала success=False